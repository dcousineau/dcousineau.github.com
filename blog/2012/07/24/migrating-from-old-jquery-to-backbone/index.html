
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Refactoring into Backbone - Tower of Power</title>
  <meta name="author" content="Daniel Cousineau">

  
  <meta name="description" content="Part 1 Backbone.js has exploded on to the scene over the past several months. Todo lists and Web3.0 full-JavaScript web applications have popped up &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://dcousineau.github.com/blog/2012/07/24/migrating-from-old-jquery-to-backbone/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Tower of Power" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Tower of Power</a></h1>
  
    <h2>Too sweet to be sour.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:dcousineau.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Refactoring Into Backbone</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-24T15:24:00-05:00" pubdate data-updated="true">Jul 24<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Part 1</h2>

<p><a href="http://backbonejs.org/">Backbone.js</a> has exploded on to the scene over the past several months. Todo lists and Web3.0 full-JavaScript web applications have popped up like weeds but there&#8217;s not much information on integrating Backbone into an existing site.</p>

<p>In the typical style of progressive enhancement, most sites are still built to work statically with some jQuery magic layered on top to give it a slicker feel. Usually, the developers of these sites dismiss Backbone.js (and other similar frameworks) as being great for pure js front-ends, but not so useful for their work. &#8220;This page is just too simple&#8221; <del>they</del> I said.</p>

<p>While I&#8217;ve been using Backbone.js for a few months now to some interesting moonlight work, only relatively recently have I been integrating Backbone.js into my main work.</p>

<h2>A Brief Tour</h2>

<p>For those unfamiliar, Backbone.js is a very lightweight, decoupled-ish MVC framework that provides 4 basic things:</p>

<ol>
<li>Models</li>
<li>Collections</li>
<li>Views</li>
<li>Router</li>
</ol>


<p>Along with some bonuses like using <a href="http://underscorejs.org/">Underscore.js</a> and jQuery (Zepto compatible!) internally (which gives <em>yet another</em> bonus of forcing more JS devs to discover the wonder that is Underscore).</p>

<p>While building in and making event firing and handling core to the system makes Backbone&#8217;s Models and Collections incredibly invaluble to highly interactive application UIs, the Backbone.View is the single most understated powerhouse in Backbone.</p>

<p>In a nutshell, all a Backbone.View really does is provide DOM element management with easy delegate event hooks. Yet even though it remains so simple and easy to replecate, the organization factor cannot be understated and thus becomes invaluable for refactoring existing code.</p>

<h2>First Steps</h2>

<p>Take, for instance, a simple list of items that can be appended to and items deleted from. This is a goss oversimplification of a refactor I recently did but the example will hold.</p>

<p>Our HTML is structured such that we can interact with the application in the absence of JavaScript (or we at least preload templates/DOM to reduce page load times):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="c">&lt;!-- ... --&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;widget&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;item&quot;</span> <span class="na">data-id=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>Item 1 <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/url/del&quot;</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;&lt;/span&gt;&lt;/li&gt;</span>
</span><span class='line'>      <span class="c">&lt;!-- ... --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="c">&lt;!-- ... --&gt;</span>
</span><span class='line'><span class="nt">&lt;script&gt;</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#widget .item a&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span><span class='line'>        <span class="p">,</span> <span class="nx">$parent</span> <span class="o">=</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">parent</span><span class="p">()</span>
</span><span class='line'>        <span class="p">,</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">$parent</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="cm">/* … */</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">//...</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Beginning our refactor process is actually not too difficult. We can assume either there is more code to this page (say, an AJAX call to fill in the list dynamically) but not really necessary.</p>

<p>We can immediatley break out all of our jquery code into a new Backbone.View:</p>

<figure class='code'><figcaption><span>scripts/foo.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span> <span class="nx">$</span><span class="p">){</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nx">namespace</span><span class="p">.</span><span class="nx">Bar</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="s1">&#39;click #widget .item a&#39;</span><span class="o">:</span> <span class="s1">&#39;clickItemDelete&#39;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="p">,</span> <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">,</span> <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">//...</span>
</span><span class='line'>          <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">,</span> <span class="nx">clickItemDelete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">)</span>
</span><span class='line'>            <span class="p">,</span> <span class="nx">$parent</span> <span class="o">=</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">parent</span><span class="p">()</span>
</span><span class='line'>            <span class="p">,</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">$parent</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>          <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="cm">/* … */</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  
</span><span class='line'><span class="p">})(</span><span class="nb">window</span><span class="p">.</span><span class="nx">Foo</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Foo</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice our click handler immediately translated? Given that jQuery is used internally, <em>almost</em> everything remains the same execpt for it being broken into two pieces: the selector (and event) visit our events attribute while the body of the event goes to inhabit it&#8217;s own method.</p>

<p><strong>There is one caveat though.</strong> Backbone prefers to keep track of the View object so it binds every event listener to the Backbone.View instance. So, unlike jQuery, <code>this</code> will be bound to the view instead of the element being acted upon. Easily enough, however, but <code>event.currentTarget</code> is essentually going to be your drop in replacement (which you can see in the above example I&#8217;ve already done so).</p>

<p>Knowing this any event listeners will be your easiest first target. For now we can dump the rest of our JavaScript code into the <code>render()</code> function.</p>

<p>After you&#8217;ve moved all your code out, you include whatever file contains your new Backbone.View and get thing started:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="c">&lt;!-- ... --&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;widget&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;&lt;span</span> <span class="na">class=</span><span class="s">&quot;item&quot;</span> <span class="na">data-id=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>Item 1 <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/url/del&quot;</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;&lt;/span&gt;&lt;/li&gt;</span>
</span><span class='line'>      <span class="c">&lt;!-- ... --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="c">&lt;!-- ... --&gt;</span>
</span><span class='line'><span class="nt">&lt;script&gt;</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">$widget</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#widget&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">.</span><span class="nx">Bar</span><span class="p">({</span>
</span><span class='line'>            <span class="nx">el</span><span class="o">:</span> <span class="nx">$widget</span>
</span><span class='line'>        <span class="p">}).</span><span class="nx">render</span><span class="p">();</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>By overriding the element to our nearest logical parent, we avoid the unnecessary task of having to re-render any interfaces and take advantage of hte pre-assembled DOM. As well this lowers the task load in converting the JavaScript code and possible rewrite event selectors.</p>

<p>At this very moment what we have is all of our previous mixed and matched jQuery front-end code tucked away in a Backbone.View with our events actually split up and refactored properly. Some may wonder why bother if this is all it organizes, and while honestly your code organization should improve instantly (no more scattered event listeners) the … &#8220;most convincing&#8221; is yet to come.</p>

<p>From here we begin the longer task of evaluating the purpose of each gropuing of JS code. What purpose it serves determines when you organize it for the first pass:</p>

<ul>
<li>Is it trying to rending something to the DOM? Probably belongs in the <code>render()</code> method.</li>
<li>Is it declaring variables and setting up requried pre-conditions? Probably belongs in the <code>initialize()</code> method.</li>
<li>Is it utility functions (like url detection methods, etc)? Each of these should be provided their own method on the view itself <em>unless</em> it is a globally utilized function (in which case should live on its own). But it should already be separate anyways :)</li>
</ul>


<p>Exactly how we approach this will be subject to my next post tomorrow.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Daniel Cousineau</span></span>

      








  


<time datetime="2012-07-24T15:24:00-05:00" pubdate data-updated="true">Jul 24<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/backbone/'>backbone</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://dcousineau.github.com/blog/2012/07/24/migrating-from-old-jquery-to-backbone/" data-via="dcousineau" data-counturl="http://dcousineau.github.com/blog/2012/07/24/migrating-from-old-jquery-to-backbone/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/07/24/migrating-from-old-jquery-to-backbone/">Refactoring into Backbone</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/dcousineau">@dcousineau</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dcousineau',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("dcousineau", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/dcousineau" class="twitter-follow-button" data-show-count="false">Follow @dcousineau</a>
  
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Daniel Cousineau -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dcousineaublog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://dcousineau.github.com/blog/2012/07/24/migrating-from-old-jquery-to-backbone/';
        var disqus_url = 'http://dcousineau.github.com/blog/2012/07/24/migrating-from-old-jquery-to-backbone/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
